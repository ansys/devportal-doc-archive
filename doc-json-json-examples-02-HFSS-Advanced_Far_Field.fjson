{"parents": [{"link": "../../", "title": "Examples"}, {"link": "../", "title": "HFSS examples"}], "prev": {"link": "../", "title": "HFSS examples"}, "next": {"link": "../Array/", "title": "HFSS: component antenna array"}, "title": "HFSS: advanced far field postprocessing", "meta": null, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-02-hfss-advanced-far-field-py\"><span class=\"std std-ref\">here</span></a>\nto download the full example code</p>\n</div>\n<section class=\"sphx-glr-example-title\" id=\"hfss-advanced-far-field-postprocessing\">\n<span id=\"sphx-glr-examples-02-hfss-advanced-far-field-py\"></span><h1>HFSS: advanced far field postprocessing<a class=\"headerlink\" href=\"#hfss-advanced-far-field-postprocessing\" title=\"Permalink to this heading\">#</a></h1>\n<p>This example shows how you can use advanced postprocessing functions to create plots\nusing Matplotlib without opening the HFSS user interface.\nThis examples runs only on Windows using CPython.</p>\n<section id=\"perform-required-imports\">\n<h2>Perform required imports<a class=\"headerlink\" href=\"#perform-required-imports\" title=\"Permalink to this heading\">#</a></h2>\n<p>Perform required imports.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">time</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">pyaedt</span>\n<span class=\"kn\">from</span> <span class=\"nn\">pyaedt.generic.general_methods</span> <span class=\"kn\">import</span> <span class=\"n\">remove_project_lock</span>\n\n<span class=\"n\">project_name</span> <span class=\"o\">=</span> <span class=\"n\">pyaedt</span><span class=\"o\">.</span><span class=\"n\">downloads</span><span class=\"o\">.</span><span class=\"n\">download_antenna_array</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n</section>\n<section id=\"set-non-graphical-mode\">\n<h2>Set non-graphical mode<a class=\"headerlink\" href=\"#set-non-graphical-mode\" title=\"Permalink to this heading\">#</a></h2>\n<p>Set non-graphical mode. <code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;PYAEDT_NON_GRAPHICAL&quot;</span></code> is needed to generate\ndocumentation only.\nYou can set <code class=\"docutils literal notranslate\"><span class=\"pre\">non_graphical</span></code> either to <code class=\"docutils literal notranslate\"><span class=\"pre\">True</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">False</span></code>.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">non_graphical</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getenv</span><span class=\"p\">(</span><span class=\"s2\">&quot;PYAEDT_NON_GRAPHICAL&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;False&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s2\">&quot;true&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;t&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"import-modules-for-postprocessing\">\n<h2>Import modules for postprocessing<a class=\"headerlink\" href=\"#import-modules-for-postprocessing\" title=\"Permalink to this heading\">#</a></h2>\n<p>Import modules for postprocessing.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n</pre></div>\n</div>\n</section>\n<section id=\"launch-aedt\">\n<h2>Launch AEDT<a class=\"headerlink\" href=\"#launch-aedt\" title=\"Permalink to this heading\">#</a></h2>\n<p>Launch AEDT 2022 R2 in non-graphical mode.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">desktopVersion</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;2022.2&quot;</span>\n<span class=\"n\">NewThread</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n<span class=\"n\">desktop</span> <span class=\"o\">=</span> <span class=\"n\">pyaedt</span><span class=\"o\">.</span><span class=\"n\">launch_desktop</span><span class=\"p\">(</span><span class=\"n\">specified_version</span><span class=\"o\">=</span><span class=\"n\">desktopVersion</span><span class=\"p\">,</span>\n                                <span class=\"n\">non_graphical</span><span class=\"o\">=</span><span class=\"n\">non_graphical</span><span class=\"p\">,</span>\n                                <span class=\"n\">new_desktop_session</span><span class=\"o\">=</span><span class=\"n\">NewThread</span>\n                                <span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"open-hfss-project\">\n<h2>Open HFSS project<a class=\"headerlink\" href=\"#open-hfss-project\" title=\"Permalink to this heading\">#</a></h2>\n<p>Open the HFSS project. <code class=\"docutils literal notranslate\"><span class=\"pre\">Hfss</span></code> class allows to initialize a new project or\nopen an existing project and point to a design name.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">remove_project_lock</span><span class=\"p\">(</span><span class=\"n\">project_name</span><span class=\"p\">)</span>\n\n<span class=\"n\">hfss</span> <span class=\"o\">=</span> <span class=\"n\">pyaedt</span><span class=\"o\">.</span><span class=\"n\">Hfss</span><span class=\"p\">(</span><span class=\"n\">projectname</span><span class=\"o\">=</span><span class=\"n\">project_name</span><span class=\"p\">,</span>\n                   <span class=\"n\">designname</span><span class=\"o\">=</span><span class=\"s2\">&quot;4X4_MultiCell_CA-Array&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"solve-hfss-project\">\n<h2>Solve HFSS project<a class=\"headerlink\" href=\"#solve-hfss-project\" title=\"Permalink to this heading\">#</a></h2>\n<p>Solves the HFSS project.\nThe solution time is computed.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">analyze_setup</span><span class=\"p\">(</span><span class=\"s2\">&quot;Setup1&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">save_project</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>True\n</pre></div>\n</div>\n</section>\n<section id=\"get-efields-data-from-solution\">\n<h2>Get efields data from solution<a class=\"headerlink\" href=\"#get-efields-data-from-solution\" title=\"Permalink to this heading\">#</a></h2>\n<p>Gets efields data from the solution.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">()</span>\n<span class=\"n\">ff_data</span> <span class=\"o\">=</span> <span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"o\">.</span><span class=\"n\">get_efields_data</span><span class=\"p\">(</span><span class=\"n\">ff_setup</span><span class=\"o\">=</span><span class=\"s2\">&quot;3D&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">end</span> <span class=\"o\">=</span> <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">time</span><span class=\"p\">()</span> <span class=\"o\">-</span> <span class=\"n\">start</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s2\">&quot;Postprocessing Time&quot;</span><span class=\"p\">,</span> <span class=\"n\">end</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>Postprocessing Time 252.61938977241516\n</pre></div>\n</div>\n</section>\n<section id=\"calculate-far-field-values\">\n<h2>Calculate far field values<a class=\"headerlink\" href=\"#calculate-far-field-values\" title=\"Permalink to this heading\">#</a></h2>\n<p>Use Matplotlib to read the solution generated in <code class=\"docutils literal notranslate\"><span class=\"pre\">ff_data</span></code>. Process\nthe field based on Phi and Theta and generate a plot.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">ff_calc</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">qty</span><span class=\"o\">=</span><span class=\"s2\">&quot;rETotal&quot;</span><span class=\"p\">,</span> <span class=\"n\">dB</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"n\">array_size</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">]</span>\n    <span class=\"n\">loc_offset</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>  <span class=\"c1\"># if array index is not starting at [1,1]</span>\n    <span class=\"n\">xphase</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">)</span>\n    <span class=\"n\">yphase</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n    <span class=\"n\">array_shape</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">array_size</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">array_size</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n    <span class=\"n\">weight</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">zeros</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"nb\">complex</span><span class=\"p\">)</span>\n    <span class=\"n\">mag</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ones</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"s2\">&quot;object&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">port_names_arranged</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">chararray</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">)</span>\n    <span class=\"n\">all_ports</span> <span class=\"o\">=</span> <span class=\"n\">ff_data</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">()</span>\n    <span class=\"n\">w_dict</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"c1\"># calculate weights based off of progressive phase shift</span>\n    <span class=\"k\">for</span> <span class=\"n\">m</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]):</span>\n        <span class=\"k\">for</span> <span class=\"n\">n</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]):</span>\n            <span class=\"n\">mag_val</span> <span class=\"o\">=</span> <span class=\"n\">mag</span><span class=\"p\">[</span><span class=\"n\">m</span><span class=\"p\">][</span><span class=\"n\">n</span><span class=\"p\">]</span>\n            <span class=\"n\">ang</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">radians</span><span class=\"p\">(</span><span class=\"n\">xphase</span> <span class=\"o\">*</span> <span class=\"n\">m</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">radians</span><span class=\"p\">(</span><span class=\"n\">yphase</span> <span class=\"o\">*</span> <span class=\"n\">n</span><span class=\"p\">)</span>\n            <span class=\"n\">weight</span><span class=\"p\">[</span><span class=\"n\">m</span><span class=\"p\">][</span><span class=\"n\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"n\">mag_val</span><span class=\"p\">)</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">exp</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"n\">j</span> <span class=\"o\">*</span> <span class=\"n\">ang</span><span class=\"p\">)</span>\n            <span class=\"n\">current_index_str</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;[&quot;</span> <span class=\"o\">+</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">m</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"o\">+</span> <span class=\"n\">loc_offset</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;,&quot;</span> <span class=\"o\">+</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">n</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"o\">+</span> <span class=\"n\">loc_offset</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;]&quot;</span>\n            <span class=\"n\">port_name</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">y</span> <span class=\"k\">for</span> <span class=\"n\">y</span> <span class=\"ow\">in</span> <span class=\"n\">all_ports</span> <span class=\"k\">if</span> <span class=\"n\">current_index_str</span> <span class=\"ow\">in</span> <span class=\"n\">y</span><span class=\"p\">]</span>\n            <span class=\"n\">w_dict</span><span class=\"p\">[</span><span class=\"n\">port_name</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"n\">weight</span><span class=\"p\">[</span><span class=\"n\">m</span><span class=\"p\">][</span><span class=\"n\">n</span><span class=\"p\">]</span>\n\n    <span class=\"n\">length_of_ff_data</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">ff_data</span><span class=\"p\">[</span><span class=\"n\">port_name</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]][</span><span class=\"mi\">2</span><span class=\"p\">])</span>\n\n    <span class=\"n\">array_shape</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">w_dict</span><span class=\"p\">),</span> <span class=\"n\">length_of_ff_data</span><span class=\"p\">)</span>\n    <span class=\"n\">rEtheta_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">zeros</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"nb\">complex</span><span class=\"p\">)</span>\n    <span class=\"n\">rEphi_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">zeros</span><span class=\"p\">(</span><span class=\"n\">array_shape</span><span class=\"p\">,</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"nb\">complex</span><span class=\"p\">)</span>\n    <span class=\"n\">w</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">zeros</span><span class=\"p\">((</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">array_shape</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]),</span> <span class=\"n\">dtype</span><span class=\"o\">=</span><span class=\"nb\">complex</span><span class=\"p\">)</span>\n    <span class=\"c1\"># create port mapping</span>\n    <span class=\"k\">for</span> <span class=\"n\">n</span><span class=\"p\">,</span> <span class=\"n\">port</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">ff_data</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">()):</span>\n        <span class=\"n\">re_theta</span> <span class=\"o\">=</span> <span class=\"n\">ff_data</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">][</span><span class=\"mi\">2</span><span class=\"p\">]</span>\n        <span class=\"n\">re_phi</span> <span class=\"o\">=</span> <span class=\"n\">ff_data</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">]</span>\n        <span class=\"n\">re_theta</span> <span class=\"o\">=</span> <span class=\"n\">re_theta</span> <span class=\"o\">*</span> <span class=\"n\">w_dict</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">]</span>\n\n        <span class=\"n\">w</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"n\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">w_dict</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">]</span>\n        <span class=\"n\">re_phi</span> <span class=\"o\">=</span> <span class=\"n\">re_phi</span> <span class=\"o\">*</span> <span class=\"n\">w_dict</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">]</span>\n\n        <span class=\"n\">rEtheta_fields</span><span class=\"p\">[</span><span class=\"n\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">re_theta</span>\n        <span class=\"n\">rEphi_fields</span><span class=\"p\">[</span><span class=\"n\">n</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">re_phi</span>\n\n        <span class=\"n\">theta_range</span> <span class=\"o\">=</span> <span class=\"n\">ff_data</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"n\">phi_range</span> <span class=\"o\">=</span> <span class=\"n\">ff_data</span><span class=\"p\">[</span><span class=\"n\">port</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"n\">theta</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"p\">(</span><span class=\"n\">theta_range</span><span class=\"p\">)),</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">(</span><span class=\"n\">theta_range</span><span class=\"p\">)),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">(</span><span class=\"n\">theta_range</span><span class=\"p\">)]</span>\n        <span class=\"n\">phi</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"p\">(</span><span class=\"n\">phi_range</span><span class=\"p\">)),</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">(</span><span class=\"n\">phi_range</span><span class=\"p\">)),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">size</span><span class=\"p\">(</span><span class=\"n\">phi_range</span><span class=\"p\">)]</span>\n        <span class=\"n\">Ntheta</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">theta_range</span><span class=\"p\">)</span>\n        <span class=\"n\">Nphi</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">phi_range</span><span class=\"p\">)</span>\n\n    <span class=\"n\">rEtheta_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">dot</span><span class=\"p\">(</span><span class=\"n\">w</span><span class=\"p\">,</span> <span class=\"n\">rEtheta_fields</span><span class=\"p\">)</span>\n    <span class=\"n\">rEtheta_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">rEtheta_fields</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">Ntheta</span><span class=\"p\">,</span> <span class=\"n\">Nphi</span><span class=\"p\">))</span>\n\n    <span class=\"n\">rEphi_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">dot</span><span class=\"p\">(</span><span class=\"n\">w</span><span class=\"p\">,</span> <span class=\"n\">rEphi_fields</span><span class=\"p\">)</span>\n    <span class=\"n\">rEphi_fields</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">reshape</span><span class=\"p\">(</span><span class=\"n\">rEphi_fields</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">Ntheta</span><span class=\"p\">,</span> <span class=\"n\">Nphi</span><span class=\"p\">))</span>\n\n    <span class=\"n\">all_qtys</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"s2\">&quot;rEPhi&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">rEphi_fields</span>\n    <span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"s2\">&quot;rETheta&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">rEtheta_fields</span>\n    <span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"s2\">&quot;rETotal&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sqrt</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">power</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">rEphi_fields</span><span class=\"p\">),</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">power</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">rEtheta_fields</span><span class=\"p\">),</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n\n    <span class=\"n\">pin</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sum</span><span class=\"p\">(</span><span class=\"n\">w</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pin</span><span class=\"p\">))</span>\n    <span class=\"n\">real_gain</span> <span class=\"o\">=</span> <span class=\"mi\">2</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">pi</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">power</span><span class=\"p\">(</span><span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"s2\">&quot;rETotal&quot;</span><span class=\"p\">],</span> <span class=\"mi\">2</span><span class=\"p\">))</span> <span class=\"o\">/</span> <span class=\"n\">pin</span> <span class=\"o\">/</span> <span class=\"mi\">377</span>\n    <span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"s2\">&quot;RealizedGain&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">real_gain</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">dB</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;Gain&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">qty</span><span class=\"p\">:</span>\n            <span class=\"n\">qty_to_plot</span> <span class=\"o\">=</span> <span class=\"mi\">10</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">log10</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"n\">qty</span><span class=\"p\">]))</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">qty_to_plot</span> <span class=\"o\">=</span> <span class=\"mi\">20</span> <span class=\"o\">*</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">log10</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"n\">qty</span><span class=\"p\">]))</span>\n        <span class=\"n\">qty_str</span> <span class=\"o\">=</span> <span class=\"n\">qty</span> <span class=\"o\">+</span> <span class=\"s2\">&quot; (dB)&quot;</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">qty_to_plot</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">abs</span><span class=\"p\">(</span><span class=\"n\">all_qtys</span><span class=\"p\">[</span><span class=\"n\">qty</span><span class=\"p\">])</span>\n        <span class=\"n\">qty_str</span> <span class=\"o\">=</span> <span class=\"n\">qty</span> <span class=\"o\">+</span> <span class=\"s2\">&quot; (mag)&quot;</span>\n\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">(</span><span class=\"n\">figsize</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">25</span><span class=\"p\">,</span> <span class=\"mi\">15</span><span class=\"p\">))</span>\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">title</span><span class=\"p\">(</span><span class=\"n\">qty_str</span><span class=\"p\">)</span>\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xlabel</span><span class=\"p\">(</span><span class=\"s2\">&quot;Theta (degree)&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">ylabel</span><span class=\"p\">(</span><span class=\"s2\">&quot;Phi (degree)&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">qty_to_plot</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"s2\">&quot;jet&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">colorbar</span><span class=\"p\">()</span>\n\n    <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">(</span><span class=\"n\">qty_to_plot</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</section>\n<section id=\"create-plot-and-interact-with-it\">\n<h2>Create plot and interact with it<a class=\"headerlink\" href=\"#create-plot-and-interact-with-it\" title=\"Permalink to this heading\">#</a></h2>\n<p>Create the plot and interact with it.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">ff_calc</span><span class=\"p\">()</span>\n\n<span class=\"c1\"># interact(ff_calc, x=widgets.FloatSlider(value=0, min=-180, max=180, step=1),</span>\n<span class=\"c1\">#          y=widgets.FloatSlider(value=0, min=-180, max=180, step=1))</span>\n\n\n<span class=\"n\">vals</span> <span class=\"o\">=</span> <span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"o\">.</span><span class=\"n\">get_far_field_data</span><span class=\"p\">(</span><span class=\"n\">setup_sweep_name</span><span class=\"o\">=</span><span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">nominal_sweep</span><span class=\"p\">,</span>\n                                    <span class=\"n\">expression</span><span class=\"o\">=</span><span class=\"s2\">&quot;RealizedGainTotal&quot;</span><span class=\"p\">,</span>\n                                    <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s2\">&quot;Elevation&quot;</span>\n                                    <span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_Advanced_Far_Field_001.png\" srcset=\"../../_images/sphx_glr_Advanced_Far_Field_001.png\" alt=\"rETotal (dB)\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>(16+0j)\n</pre></div>\n</div>\n</section>\n<section id=\"generate-polar-plot\">\n<h2>Generate polar plot<a class=\"headerlink\" href=\"#generate-polar-plot\" title=\"Permalink to this heading\">#</a></h2>\n<p>Generate a polar plot.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">vals</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">math_formula</span><span class=\"o\">=</span><span class=\"s2\">&quot;db20&quot;</span><span class=\"p\">,</span> <span class=\"n\">is_polar</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_Advanced_Far_Field_002.png\" srcset=\"../../_images/sphx_glr_Advanced_Far_Field_002.png\" alt=\"Simulation Results Plot\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>&lt;Figure size 2000x1000 with 1 Axes&gt;\n</pre></div>\n</div>\n</section>\n<section id=\"generate-scalar-plot\">\n<h2>Generate scalar plot<a class=\"headerlink\" href=\"#generate-scalar-plot\" title=\"Permalink to this heading\">#</a></h2>\n<p>Generate a scalar plot.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">vals</span><span class=\"o\">.</span><span class=\"n\">plot</span><span class=\"p\">(</span><span class=\"n\">math_formula</span><span class=\"o\">=</span><span class=\"s2\">&quot;db20&quot;</span><span class=\"p\">,</span> <span class=\"n\">is_polar</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_Advanced_Far_Field_003.png\" srcset=\"../../_images/sphx_glr_Advanced_Far_Field_003.png\" alt=\"Simulation Results Plot\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>&lt;Figure size 2000x1000 with 1 Axes&gt;\n</pre></div>\n</div>\n</section>\n<section id=\"generate-plot-using-phi-as-primary-sweep\">\n<h2>Generate plot using Phi as primary sweep<a class=\"headerlink\" href=\"#generate-plot-using-phi-as-primary-sweep\" title=\"Permalink to this heading\">#</a></h2>\n<p>Generate the plot using Phi as the primary sweep.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">vals3d</span> <span class=\"o\">=</span> <span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"o\">.</span><span class=\"n\">get_far_field_data</span><span class=\"p\">(</span><span class=\"n\">setup_sweep_name</span><span class=\"o\">=</span><span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">nominal_sweep</span><span class=\"p\">,</span>\n                                      <span class=\"n\">expression</span><span class=\"o\">=</span><span class=\"s2\">&quot;RealizedGainTotal&quot;</span><span class=\"p\">,</span>\n                                      <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s2\">&quot;Infinite Sphere1&quot;</span>\n                                      <span class=\"p\">)</span>\n\n<span class=\"n\">vals3d</span><span class=\"o\">.</span><span class=\"n\">plot_3d</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<img src=\"../../_images/sphx_glr_Advanced_Far_Field_004.png\" srcset=\"../../_images/sphx_glr_Advanced_Far_Field_004.png\" alt=\"Simulation Results Plot\" class = \"sphx-glr-single-img\"/><div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>&lt;Figure size 2000x1000 with 1 Axes&gt;\n</pre></div>\n</div>\n</section>\n<section id=\"close-hfss-project-and-aedt\">\n<h2>Close HFSS project and AEDT<a class=\"headerlink\" href=\"#close-hfss-project-and-aedt\" title=\"Permalink to this heading\">#</a></h2>\n<p>Close the HFSS project and release AEDT.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"c1\"># hfss.close_project()</span>\n<span class=\"n\">hfss</span><span class=\"o\">.</span><span class=\"n\">save_project</span><span class=\"p\">()</span>\n<span class=\"n\">desktop</span><span class=\"o\">.</span><span class=\"n\">release_desktop</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>True\n</pre></div>\n</div>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 13 minutes  5.502 seconds)</p>\n<div class=\"sphx-glr-footer sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-02-hfss-advanced-far-field-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/0ce391b8f8bb3d06931226fd1f2dec74/Advanced_Far_Field.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">Advanced_Far_Field.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/cac2814f5907dec629e549e35b82c100/Advanced_Far_Field.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">Advanced_Far_Field.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["examples/02-HFSS/Array", "HFSS: component antenna array", "N", "next"], ["examples/02-HFSS/index", "HFSS examples", "P", "previous"]], "sourcename": "examples/02-HFSS/Advanced_Far_Field.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">HFSS: advanced far field postprocessing</a><ul>\n<li><a class=\"reference internal\" href=\"#perform-required-imports\">Perform required imports</a></li>\n<li><a class=\"reference internal\" href=\"#set-non-graphical-mode\">Set non-graphical mode</a></li>\n<li><a class=\"reference internal\" href=\"#import-modules-for-postprocessing\">Import modules for postprocessing</a></li>\n<li><a class=\"reference internal\" href=\"#launch-aedt\">Launch AEDT</a></li>\n<li><a class=\"reference internal\" href=\"#open-hfss-project\">Open HFSS project</a></li>\n<li><a class=\"reference internal\" href=\"#solve-hfss-project\">Solve HFSS project</a></li>\n<li><a class=\"reference internal\" href=\"#get-efields-data-from-solution\">Get efields data from solution</a></li>\n<li><a class=\"reference internal\" href=\"#calculate-far-field-values\">Calculate far field values</a></li>\n<li><a class=\"reference internal\" href=\"#create-plot-and-interact-with-it\">Create plot and interact with it</a></li>\n<li><a class=\"reference internal\" href=\"#generate-polar-plot\">Generate polar plot</a></li>\n<li><a class=\"reference internal\" href=\"#generate-scalar-plot\">Generate scalar plot</a></li>\n<li><a class=\"reference internal\" href=\"#generate-plot-using-phi-as-primary-sweep\">Generate plot using Phi as primary sweep</a></li>\n<li><a class=\"reference internal\" href=\"#close-hfss-project-and-aedt\">Close HFSS project and AEDT</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples/02-HFSS/Advanced_Far_Field", "sidebars": ["search-field.html", "sidebar-nav-bs.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "theme_show_toc_level": 1, "theme_logo": {}}